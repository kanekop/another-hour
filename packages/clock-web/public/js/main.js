"use strict";(()=>{var Me=Object.create;var se=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var Ae=Object.getOwnPropertyNames;var He=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var Ce=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports);var Ee=(d,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ae(e))!ve.call(d,n)&&n!==t&&se(d,n,{get:()=>e[n],enumerable:!(r=ye(e,n))||r.enumerable});return d};var be=(d,e,t)=>(t=d!=null?Me(He(d)):{},Ee(e||!d||!d.__esModule?se(t,"default",{value:d,enumerable:!0}):t,d));var le=Ce((de,W)=>{(function(){"use strict";var d=Math.PI,e=Math.sin,t=Math.cos,r=Math.tan,n=Math.asin,s=Math.atan2,a=Math.acos,i=d/180,c=1e3*60*60*24,T=2440588,S=2451545;function y(o){return o.valueOf()/c-.5+T}function w(o){return new Date((o+.5-T)*c)}function F(o){return y(o)-S}var U=i*23.4397;function z(o,u){return s(e(o)*t(U)-r(u)*e(U),t(o))}function $(o,u){return n(e(u)*t(U)+t(u)*e(U)*e(o))}function q(o,u,l){return s(e(o),t(o)*e(u)-r(l)*t(u))}function K(o,u,l){return n(e(u)*e(l)+t(u)*t(l)*t(o))}function X(o,u){return i*(280.16+360.9856235*o)-u}function pe(o){return o<0&&(o=0),2967e-7/Math.tan(o+.00312536/(o+.08901179))}function Y(o){return i*(357.5291+.98560028*o)}function Q(o){var u=i*(1.9148*e(o)+.02*e(2*o)+3e-4*e(3*o)),l=i*102.9372;return o+u+l+d}function Z(o){var u=Y(o),l=Q(u);return{dec:$(l,0),ra:z(l,0)}}var M={};M.getPosition=function(o,u,l){var g=i*-l,m=i*u,p=F(o),h=Z(p),f=X(p,g)-h.ra;return{azimuth:q(f,m,h.dec),altitude:K(f,m,h.dec)}};var G=M.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];M.addTime=function(o,u,l){G.push([o,u,l])};var ee=9e-4;function fe(o,u){return Math.round(o-ee-u/(2*d))}function te(o,u,l){return ee+(o+u)/(2*d)+l}function re(o,u,l){return S+o+.0053*e(u)-.0069*e(2*l)}function Te(o,u,l){return a((e(o)-e(u)*e(l))/(t(u)*t(l)))}function Se(o){return-2.076*Math.sqrt(o)/60}function De(o,u,l,g,m,p,h){var f=Te(o,l,g),D=te(f,u,m);return re(D,p,h)}M.getTimes=function(o,u,l,g){g=g||0;var m=i*-l,p=i*u,h=Se(g),f=F(o),D=fe(f,m),H=te(0,m,D),E=Y(H),x=Q(E),L=$(x,0),b=re(H,E,x),P,R,I,v,k,_,A={solarNoon:w(b),nadir:w(b-.5)};for(P=0,R=G.length;P<R;P+=1)I=G[P],v=(I[0]+h)*i,k=De(v,m,p,L,D,E,x),_=b-(k-b),A[I[1]]=w(_),A[I[2]]=w(k);return A};function ne(o){var u=i*(218.316+13.176396*o),l=i*(134.963+13.064993*o),g=i*(93.272+13.22935*o),m=u+i*6.289*e(l),p=i*5.128*e(g),h=385001-20905*t(l);return{ra:z(m,p),dec:$(m,p),dist:h}}M.getMoonPosition=function(o,u,l){var g=i*-l,m=i*u,p=F(o),h=ne(p),f=X(p,g)-h.ra,D=K(f,m,h.dec),H=s(e(f),r(m)*t(h.dec)-e(h.dec)*t(f));return D=D+pe(D),{azimuth:q(f,m,h.dec),altitude:D,distance:h.dist,parallacticAngle:H}},M.getMoonIllumination=function(o){var u=F(o||new Date),l=Z(u),g=ne(u),m=149598e3,p=a(e(l.dec)*e(g.dec)+t(l.dec)*t(g.dec)*t(l.ra-g.ra)),h=s(m*e(p),g.dist-m*t(p)),f=s(t(l.dec)*e(l.ra-g.ra),e(l.dec)*t(g.dec)-t(l.dec)*e(g.dec)*t(l.ra-g.ra));return{fraction:(1+t(h))/2,phase:.5+.5*h*(f<0?-1:1)/Math.PI,angle:f}};function B(o,u){return new Date(o.valueOf()+u*c/24)}M.getMoonTimes=function(o,u,l,g){var m=new Date(o);g?m.setUTCHours(0,0,0,0):m.setHours(0,0,0,0);for(var p=.133*i,h=M.getMoonPosition(m,u,l).altitude-p,f,D,H,E,x,L,b,P,R,I,v,k,_,A=1;A<=24&&(f=M.getMoonPosition(B(m,A),u,l).altitude-p,D=M.getMoonPosition(B(m,A+1),u,l).altitude-p,x=(h+D)/2-f,L=(D-h)/2,b=-L/(2*x),P=(x*b+L)*b+f,R=L*L-4*x*f,I=0,R>=0&&(_=Math.sqrt(R)/(Math.abs(x)*2),v=b-_,k=b+_,Math.abs(v)<=1&&I++,Math.abs(k)<=1&&I++,v<-1&&(v=k)),I===1?h<0?H=A+v:E=A+v:I===2&&(H=A+(P<0?k:v),E=A+(P<0?v:k)),!(H&&E));A+=2)h=D;var O={};return H&&(O.rise=B(m,H)),E&&(O.set=B(m,E)),!H&&!E&&(O[P>0?"alwaysUp":"alwaysDown"]=!0),O},typeof de=="object"&&typeof W<"u"?W.exports=M:typeof define=="function"&&define.amd?define(M):window.SunCalc=M})()});function ie(d,e,t){if(e<=0)throw new Error("designed24Duration must be greater than 0");let n=(d.getTime()-t.getTime())/(1e3*60*60),s,a;if(n<e){let i=24/e,c=n*i;s=c*30%360,a=c*60%60*6}else{let i=n-e,c=24-e;s=i%c*30%360,a=i%c*60%60*6}return{hourAngle:s,minuteAngle:a}}function oe(d,e,t){if(e<=0)throw new Error("designed24Duration must be greater than 0");let n=(d.getTime()-t.getTime())/(1e3*60*60),s,a;if(n<e){let i=24/e,c=n*i;s=Math.floor(c)%24,a=Math.floor(c%1*60)}else{let i=n-e;s=Math.floor(i)%24,a=Math.floor(i%1*60)}return{hours:s,minutes:a}}function ae(d,e,t){if(e<=0)throw new Error("designed24Duration must be greater than 0");return(d.getTime()-t.getTime())/(1e3*60*60)<e}var N={user:{dayStartTime:"00:00",defaultTimezone:"Asia/Tokyo",preferredMode:"classic"},classic:{designed24Duration:1380},coreTime:{coreTimeStart:"07:00",coreTimeEnd:"22:00",minCoreHours:6,anotherHourAllocation:null},wakeBased:{defaultWakeTime:"07:00",anotherHourDuration:60,maxScaleFactor:2},solar:{dayHoursTarget:12,seasonalAdjustment:!1}};var C=class d{constructor(e){if(this.constructor===d)throw new Error("BaseMode is an abstract class and cannot be instantiated directly");this.config=e,this.validateConfig()}validateConfig(){if(!this.config||!this.config.parameters)throw new Error("Invalid configuration: parameters are required")}calculateScaleFactor(e){throw new Error("calculateScaleFactor must be implemented by subclass")}getCurrentPhase(e){throw new Error("getCurrentPhase must be implemented by subclass")}calculateAnotherHourTime(e){throw new Error("calculateAnotherHourTime must be implemented by subclass")}convertToAnotherHour(e){return this.calculateAnotherHourTime(e)}convertToRealTime(e){throw new Error("convertToRealTime must be implemented by subclass")}getClockAngles(e){let t=this.calculateAnotherHourTime(e),r=t.getHours(),n=t.getMinutes(),s=t.getSeconds(),a=t.getMilliseconds(),i=(r%12+n/60+s/3600)*30,c=(n+s/60+a/6e4)*6,T=(s+a/1e3)*6;return{hours:i,minutes:c,seconds:T}}getDescription(){return this.config.description||"No description available"}exportConfig(){return{mode:this.config.mode,parameters:{...this.config.parameters},name:this.config.name,description:this.config.description}}getDebugInfo(e){return{mode:this.constructor.name,config:this.config,scaleFactor:this.calculateScaleFactor(e)}}getTimelineSegments(){return[]}getConfigSchema(){return null}};var ce=class d extends C{static{this.modeId="classic"}static{this.modeName="Classic"}static{this.description='A standard day divided into a scaled period and a real-time "another hour".'}static{this.defaultParameters={designed24Hours:22}}constructor(e){super(e);let t={...d.defaultParameters,...e.parameters};this.designed24Duration=t.designed24Hours*60,this.dayStartTime=this.parseDayStartTime(e.userSettings?.dayStartTime||N.user.dayStartTime),this.validateConfig()}validateConfig(){if(super.validateConfig(),this.designed24Duration<0||this.designed24Duration>1440)throw new Error("Designed 24 duration must be between 0 and 24 hours")}parseDayStartTime(e){let[t,r]=e.split(":").map(Number);return t*60+r}calculateScaleFactor(e){return this.getCurrentPhase(e).name==="Designed 24"?24/(this.designed24Duration/60):1}getCurrentPhase(e){let t=this.getMinutesSinceDayStart(e);if(t<this.designed24Duration)return{name:"Designed 24",progress:t/this.designed24Duration,remainingMinutes:this.designed24Duration-t};{let r=this.designed24Duration,n=t-r,s=1440-this.designed24Duration;return{name:"Another Hour",progress:n/s,remainingMinutes:s-n}}}getMinutesSinceDayStart(e){let r=e.getHours()*60+e.getMinutes()-this.dayStartTime;return r<0&&(r+=1440),r}calculateAnotherHourTime(e){let t=this.getMinutesSinceDayStart(e),r;if(t<this.designed24Duration){let a=this.calculateScaleFactor(e);r=t*a}else{let a=this.designed24Duration*(24/(this.designed24Duration/60)),i=t-this.designed24Duration;r=a+i}let n=new Date(e),s=this.dayStartTime+r;return n.setHours(Math.floor(s/60)%24),n.setMinutes(Math.floor(s%60)),n.setSeconds(Math.floor(s%1*60)),n}convertToRealTime(e){let r=e.getHours()*60+e.getMinutes()-this.dayStartTime,n,s=24*60;if(r<s){let c=24/(this.designed24Duration/60);n=r/c}else{let c=r-s;n=this.designed24Duration+c}let a=new Date(e),i=this.dayStartTime+n;return a.setHours(Math.floor(i/60)%24),a.setMinutes(Math.floor(i%60)),a}getDebugInfo(e){return{...super.getDebugInfo(e),designed24Duration:this.designed24Duration,dayStartTime:`${Math.floor(this.dayStartTime/60)}:${String(this.dayStartTime%60).padStart(2,"0")}`,designed24Hours:this.designed24Duration/60,anotherHourDuration:1440-this.designed24Duration,currentPhase:this.getCurrentPhase(e)}}getTimelineSegments(){let e=this.designed24Duration/1440*100;return[{name:"Designed 24",start:0,end:e,color:"#3498DB",label:"Designed 24"},{name:"Another Hour",start:e,end:100,color:"#95A5A6",label:"Another Hour"}]}static getConfigSchema(){return{designed24Hours:{type:"slider",label:"Designed 24 Duration",min:1,max:23.5,step:.5,default:this.defaultParameters.designed24Hours,unit:"h"}}}exportConfig(){return{...super.exportConfig(),parameters:{designed24Hours:this.designed24Duration/60}}}};var ue=class d extends C{static{this.modeId="core-time"}static{this.modeName="Core Time"}static{this.description='Compresses a specific "core time" (like work hours) and leaves the rest of the day at normal speed.'}static{this.defaultParameters={coreTimeStart:"09:00",coreTimeEnd:"17:00"}}constructor(e){super(e);let t={...d.defaultParameters,...e.parameters},r=e.userSettings;this.coreTimeStartStr=t.coreTimeStart,this.coreTimeEndStr=t.coreTimeEnd,this.minCoreHours=t.minCoreHours||N.coreTime.minCoreHours,this.anotherHourAllocation=t.anotherHourAllocation??N.coreTime.anotherHourAllocation,this.dayStartTime=this.parseTime(r?.dayStartTime||N.user.dayStartTime),this.coreTimeStart=this.parseTime(this.coreTimeStartStr),this.coreTimeEnd=this.parseTime(this.coreTimeEndStr),this.validateConfig()}validateConfig(){if(super.validateConfig(),this.coreTimeStart===this.coreTimeEnd)throw new Error("Core Time start and end times cannot be the same.");let e=(this.coreTimeEnd-this.coreTimeStart+1440)%1440;if(e<this.minCoreHours*60)throw new Error(`Core Time must be at least ${this.minCoreHours} hours`);if(this.anotherHourAllocation!==null&&this.anotherHourAllocation!==void 0){if(this.anotherHourAllocation<0||this.anotherHourAllocation>720)throw new Error("AnotherHourAllocation must be between 0 and 12 hours")}else if(1440-e>720)throw new Error("Total Another Hour cannot exceed 12 hours")}parseTime(e){let[t,r]=e.split(":").map(Number);return t*60+r}calculateScaleFactor(e){if(this.getCurrentPhase(e).name==="Core Time"){let r=(this.coreTimeEnd-this.coreTimeStart+1440)%1440;if(r===0)return 1;let n=(this.coreTimeStart-this.dayStartTime+1440)%1440,s=(this.dayStartTime-this.coreTimeEnd+1440)%1440,a=n+s;return(this.anotherHourAllocation!==null&&this.anotherHourAllocation!==void 0?1440-this.anotherHourAllocation:1440-a)/r}return 1}getCurrentPhase(e){let t=e.getHours()*60+e.getMinutes();if(this.coreTimeStart<=this.coreTimeEnd?t>=this.coreTimeStart&&t<this.coreTimeEnd:t>=this.coreTimeStart||t<this.coreTimeEnd){let s=(this.coreTimeEnd-this.coreTimeStart+1440)%1440;return{name:"Core Time",progress:(t-this.coreTimeStart+1440)%1440/s}}if(this.dayStartTime<=this.coreTimeStart?t>=this.dayStartTime&&t<this.coreTimeStart:t>=this.dayStartTime||t<this.coreTimeStart){let s=(this.coreTimeStart-this.dayStartTime+1440)%1440;return{name:"Morning AH",progress:(t-this.dayStartTime+1440)%1440/s}}else{let s=(this.dayStartTime-this.coreTimeEnd+1440)%1440;return{name:"Evening AH",progress:(t-this.coreTimeEnd+1440)%1440/s}}}calculateAnotherHourTime(e){let t=e.getHours()*60+e.getMinutes()+e.getSeconds()/60,r=(this.coreTimeStart-this.dayStartTime+1440)%1440,n=this.calculateScaleFactor(e),a=(this.coreTimeEnd-this.coreTimeStart+1440)%1440*n,i,c=this.getCurrentPhase(e);if(c.name==="Morning AH")i=(t-this.dayStartTime+1440)%1440;else if(c.name==="Core Time"){let y=(t-this.coreTimeStart+1440)%1440;i=r+y*n}else{let y=(t-this.coreTimeEnd+1440)%1440;i=r+a+y}let T=i,S=new Date(e);return S.setHours(Math.floor(T/60)%24),S.setMinutes(Math.floor(T%60)),S.setSeconds(Math.floor(T*60%60)),S}convertToRealTime(e){let t=e.getHours()*60+e.getMinutes()+e.getSeconds()/60,r=(this.coreTimeStart-this.dayStartTime+1440)%1440,n=new Date(e);n.setHours(Math.floor(this.coreTimeStart/60),this.coreTimeStart%60,0,0);let s=this.calculateScaleFactor(n);if(s===0)return e;let i=(this.coreTimeEnd-this.coreTimeStart+1440)%1440*s,c,T=this.parseTime(this.config.userSettings?.dayStartTime||N.user.dayStartTime),S=(t-T+1440)%1440;if(S<r)c=(this.dayStartTime+S)%1440;else if(S<r+i){let F=(S-r)/s;c=(this.coreTimeStart+F)%1440}else{let w=S-r-i;c=(this.coreTimeEnd+w)%1440}let y=new Date(e);return y.setHours(Math.floor(c/60),Math.floor(c%60),Math.floor(c*60%60)),y}getDebugInfo(e){let t=super.getDebugInfo(e),r=(this.coreTimeStart-this.dayStartTime+1440)%1440,n=(this.dayStartTime-this.coreTimeEnd+1440)%1440,s=(this.coreTimeEnd-this.coreTimeStart+1440)%1440,a=this.calculateScaleFactor(e),i=s*a;return{...t,coreTimeStart:this.coreTimeStartStr,coreTimeEnd:this.coreTimeEndStr,dayStartTime:`${Math.floor(this.dayStartTime/60)}:${String(this.dayStartTime%60).padStart(2,"0")}`,durations:{morningAH:r,coreTime:s,eveningAH:n},ahDurations:{morningAH:r,coreTime:i,eveningAH:n},scaleFactor:a,currentPhase:this.getCurrentPhase(e)}}getTimelineSegments(){let e=n=>n/1440*100,t=e(this.coreTimeStart),r=e(this.coreTimeEnd);return t<r?[{name:"Another Hour",start:0,end:t,color:"#85C1E9",label:"Another Hour"},{name:"Core Time",start:t,end:r,color:"#2874A6",label:"Core Time"},{name:"Another Hour",start:r,end:100,color:"#85C1E9",label:"Another Hour"}]:[{name:"Core Time",start:0,end:r,color:"#2874A6",label:"Core Time"},{name:"Another Hour",start:r,end:t,color:"#85C1E9",label:"Another Hour"},{name:"Core Time",start:t,end:100,color:"#2874A6",label:"Core Time"}]}static getConfigSchema(){return{coreTimeStart:{type:"time",label:"Core Time Start",default:d.defaultParameters.coreTimeStart},coreTimeEnd:{type:"time",label:"Core Time End",default:d.defaultParameters.coreTimeEnd}}}exportConfig(){return{...super.exportConfig(),parameters:{coreTimeStart:this.formatTime(this.coreTimeStart),coreTimeEnd:this.formatTime(this.coreTimeEnd)}}}formatTime(e){let t=Math.floor(e/60).toString().padStart(2,"0"),r=(e%60).toString().padStart(2,"0");return`${t}:${r}`}};var he=be(le()),me=class d extends C{static{this.modeId="solar"}static{this.modeName="Solar"}static{this.description="Aligns the day with solar events like sunrise and sunset, scaling day and night independently."}static{this.defaultParameters={location:{key:"tokyo",name:"Tokyo",latitude:35.6895,longitude:139.6917,tz:"Asia/Tokyo"},designedDayHours:12}}constructor(e){super(e);let t={...d.defaultParameters,...e.parameters};this.location=t.location,this.designedDayHours=t.designedDayHours,this.validateConfig()}validateConfig(){if(!this.location||typeof this.location.latitude!="number"||typeof this.location.longitude!="number")throw new Error("SolarMode requires a valid location with latitude and longitude.");if(this.designedDayHours<1||this.designedDayHours>23)throw new Error("Designed Day Hours must be between 1 and 23.")}getSunlightTimes(e){return he.getTimes(e,this.location.latitude,this.location.longitude)}getSolarInfo(e=new Date){return this.getSunlightTimes(e)}getCurrentPhase(e){let t=this.getSunlightTimes(e),{sunrise:r,sunset:n}=t,s=new Date(e);s.setDate(e.getDate()-1);let a=this.getSunlightTimes(s);if(e>=r&&e<n){let i=n.getTime()-r.getTime(),c=e.getTime()-r.getTime();return{name:"Day",progress:i>0?c/i:0}}else{let i,c;if(e<r)i=a.sunset,c=r;else{let y=new Date(e);y.setDate(e.getDate()+1);let w=this.getSunlightTimes(y);i=n,c=w.sunrise}let T=c.getTime()-i.getTime(),S=e.getTime()-i.getTime();return{name:"Night",progress:T>0?S/T:0}}}calculateScaleFactor(e){let t=this.getSunlightTimes(e),r=(t.sunset.getTime()-t.sunrise.getTime())/36e5,n=24-r;return r<=0||n<=0?1:this.getCurrentPhase(e).name==="Day"?this.designedDayHours/r:(24-this.designedDayHours)/n}calculateAnotherHourTime(e){let t=this.getSunlightTimes(e),r=this.getCurrentPhase(e),n=(24-this.designedDayHours)/2,s;if(r.name==="Day"){let i=this.designedDayHours*60;s=n*60+r.progress*i}else{let i=(24-this.designedDayHours)*60,c=n+this.designedDayHours,T=r.progress*i;e>t.sunset?s=c*60+T:(s=T-(24-c)*60,s<0&&(s+=1440))}s=(s+1440)%1440;let a=new Date(0);return a.setUTCMinutes(s),a}convertToRealTime(e){return e}getDebugInfo(e){let t=this.getSunlightTimes(e);return{...super.getDebugInfo(e),location:this.location,designedDayHours:this.designedDayHours,solarTimes:{sunrise:t.sunrise.toLocaleTimeString(),sunset:t.sunset.toLocaleTimeString(),solarNoon:t.solarNoon.toLocaleTimeString()}}}getTimelineSegments(){let e=this.getSunlightTimes(new Date),t=r=>(r.getHours()*60+r.getMinutes())/1440*100;return[{name:"Night",start:0,end:t(e.dawn),color:"#1A237E",label:"Night"},{name:"Sunrise",start:t(e.dawn),end:t(e.sunriseEnd),color:"#FFB300",label:"Sunrise"},{name:"Daylight",start:t(e.sunriseEnd),end:t(e.sunsetStart),color:"#FFD600",label:"Daylight"},{name:"Sunset",start:t(e.sunsetStart),end:t(e.dusk),color:"#D32F2F",label:"Sunset"},{name:"Night",start:t(e.dusk),end:100,color:"#1A237E",label:"Night"}]}static getConfigSchema(){return{designedDayHours:{type:"slider",label:"Designed Day Hours",min:1,max:23,step:.5,default:this.defaultParameters.designedDayHours,unit:"h"}}}exportConfig(){return{...super.exportConfig(),parameters:{location:this.location,designedDayHours:this.designedDayHours}}}};var ge=class d extends C{static{this.modeId="wake-based"}static{this.modeName="Wake-based"}static{this.description="Scales your active hours based on when you wake up and how long you are active."}static{this.defaultParameters={wakeTime:"07:00",activityDurationHours:16}}constructor(e){super(e);let t={...d.defaultParameters,...e.parameters};this.wakeTime=this.parseTime(t.wakeTime),this.activityDuration=t.activityDurationHours*60,this.validateParameters()}validateParameters(){if(this.activityDuration<60||this.activityDuration>1440)throw new Error("Activity Duration must be between 1 and 24 hours.")}parseTime(e){let[t,r]=e.split(":").map(Number);return t*60+r}getCurrentPhase(e){let t=e.getHours()*60+e.getMinutes(),r=(this.wakeTime+this.activityDuration)%1440;if(this.wakeTime<r?t>=this.wakeTime&&t<r:t>=this.wakeTime||t<r)return{name:"Activity Period",progress:(t-this.wakeTime+1440)%1440/this.activityDuration};{let s=r,a=1440-this.activityDuration;return{name:"Another Hour",progress:(t-s+1440)%1440/a}}}calculateScaleFactor(e){return this.getCurrentPhase(e).name==="Activity Period"?(1440-(1440-this.activityDuration))/this.activityDuration:1}calculateAnotherHourTime(e){let t=this.getCurrentPhase(e),r=this.calculateScaleFactor(e),n;if(t.name==="Activity Period"){let i=(e.getHours()*60+e.getMinutes()-this.wakeTime+1440)%1440*r;n=(this.wakeTime+i)%1440}else{let a=this.activityDuration*r,i=(this.wakeTime+this.activityDuration)%1440,c=(e.getHours()*60+e.getMinutes()-i+1440)%1440;n=(this.wakeTime+a+c)%1440}let s=new Date(0);return s.setUTCMinutes(n),s}convertToRealTime(e){return e}getDebugInfo(e){return{...super.getDebugInfo(e),wakeTime:this.formatTime(this.wakeTime),activityDurationHours:this.activityDuration/60,phase:this.getCurrentPhase(e),scaleFactor:this.calculateScaleFactor(e)}}getTimelineSegments(){let e=this.wakeTime/1440*100,t=(this.wakeTime+this.activityDuration)%1440/1440*100;return e<t?[{name:"Another Hour",start:0,end:e,color:"#95A5A6",label:"Another Hour"},{name:"Activity Period",start:e,end:t,color:"#3498DB",gradient:"linear-gradient(to right, #2980B9, #3498DB)",label:"Activity"},{name:"Another Hour",start:t,end:100,color:"#95A5A6",label:"Another Hour"}]:[{name:"Activity Period",start:0,end:t,color:"#3498DB",gradient:"linear-gradient(to right, #2980B9, #3498DB)",label:"Activity"},{name:"Another Hour",start:t,end:e,color:"#95A5A6",label:"Another Hour"},{name:"Activity Period",start:e,end:100,color:"#3498DB",gradient:"linear-gradient(to right, #2980B9, #3498DB)",label:"Activity"}]}static getConfigSchema(){return{wakeTime:{type:"time",label:"Wake Time",default:this.defaultParameters.wakeTime},activityDurationHours:{type:"slider",label:"Activity Duration",min:1,max:23,step:.5,default:this.defaultParameters.activityDurationHours,unit:"h"}}}exportConfig(){return{...super.exportConfig(),parameters:{wakeTime:this.formatTime(this.wakeTime),activityDurationHours:this.activityDuration/60}}}formatTime(e){let t=Math.floor(e/60).toString().padStart(2,"0"),r=(e%60).toString().padStart(2,"0");return`${t}:${r}`}};var V=class{constructor(){this.settings={duration:parseInt(localStorage.getItem("ah_duration")||"16"),startHour:parseInt(localStorage.getItem("ah_start_hour")||"6")}}save(e){this.settings={...this.settings,...e},localStorage.setItem("ah_duration",this.settings.duration.toString()),localStorage.setItem("ah_start_hour",this.settings.startHour.toString())}getSettings(){return this.settings}getD24StartTime(){let e=new Date,t=new Date(e);return t.setHours(this.settings.startHour,0,0,0),e<t&&t.setDate(t.getDate()-1),t}};var J=class{constructor(e){this.animationFrameId=null;this.settings=e,this.elements={hourHand:document.getElementById("hour-hand"),minuteHand:document.getElementById("minute-hand"),secondHand:document.getElementById("second-hand"),ahTime:document.getElementById("ah-time"),realTime:document.getElementById("real-time"),phaseName:document.getElementById("phase-name"),body:document.body}}start(){this.animationFrameId===null&&this.update()}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}update(){let e=new Date,t=this.settings.getSettings(),r=this.settings.getD24StartTime(),n=ie(e,t.duration,r),s=oe(e,t.duration,r),a=ae(e,t.duration,r);this.updateAnalogClock(n,e),this.updateDigitalDisplay(s,e),this.updatePhase(a),this.animationFrameId=requestAnimationFrame(()=>this.update())}updateAnalogClock(e,t){let{hourHand:r,minuteHand:n,secondHand:s}=this.elements;r.style.transform=`rotate(${e.hourAngle}deg)`,n.style.transform=`rotate(${e.minuteAngle}deg)`;let a=t.getSeconds()*6+t.getMilliseconds()*.006;s.style.transform=`rotate(${a}deg)`}updateDigitalDisplay(e,t){let{ahTime:r,realTime:n}=this.elements,s=String(e.hours).padStart(2,"0"),a=String(e.minutes).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");r.textContent=`${s}:${a}:${i}`;let c=String(t.getHours()).padStart(2,"0"),T=String(t.getMinutes()).padStart(2,"0"),S=String(t.getSeconds()).padStart(2,"0");n.textContent=`Real: ${c}:${T}:${S}`}updatePhase(e){let{phaseName:t,body:r}=this.elements;e?(t.textContent="Designed 24",r.classList.remove("another-hour-phase")):(t.textContent="Another Hour",r.classList.add("another-hour-phase"))}},j=class{constructor(e){this.settings=e,this.modal=document.getElementById("settings-modal"),this.setupEventListeners()}setupEventListeners(){let e=document.getElementById("settings-btn"),t=document.getElementById("save-settings"),r=document.getElementById("cancel-settings");e.addEventListener("click",()=>this.open()),t.addEventListener("click",()=>this.save()),r.addEventListener("click",()=>this.close()),this.modal.addEventListener("click",n=>{n.target===this.modal&&this.close()})}open(){let e=this.settings.getSettings(),t=document.getElementById("duration-input"),r=document.getElementById("start-hour-input");t.value=e.duration.toString(),r.value=e.startHour.toString(),this.modal.classList.remove("hidden")}close(){this.modal.classList.add("hidden")}save(){let e=document.getElementById("duration-input"),t=document.getElementById("start-hour-input"),r=parseInt(e.value),n=parseInt(t.value);r>=1&&r<=23&&n>=0&&n<=23&&(this.settings.save({duration:r,startHour:n}),this.close())}};function xe(){Pe();let d=new V,e=new J(d);new j(d),e.start()}function Pe(){let d=document.getElementById("clock-ticks");if(d)for(let e=0;e<12;e++){let t=e*30-90,r=10,n=100+85*Math.cos(t*Math.PI/180),s=100+85*Math.sin(t*Math.PI/180),a=100+(95-r)*Math.cos(t*Math.PI/180),i=100+(95-r)*Math.sin(t*Math.PI/180),c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1",n.toString()),c.setAttribute("y1",s.toString()),c.setAttribute("x2",a.toString()),c.setAttribute("y2",i.toString()),c.setAttribute("class","clock-tick"),d.appendChild(c)}}document.addEventListener("DOMContentLoaded",xe);})();
