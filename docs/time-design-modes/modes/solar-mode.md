# Solar Mode: A Deep Dive

**📋 完全仕様書**: より詳細な技術仕様は [Solar Mode Complete Specification](../../specifications/solar-mode-spec.md) を参照してください。

**🧪 テストページ**: [Solar Mode Test Page](/pages/time-design-test.html)

## 📋 概要 (Overview)

Solar Mode（太陽光モード）は、**地球の自然なリズムとあなたの生活を同期させる**ことを目的とした、ダイナミックな時間設計モードです。

このモードの最大の特徴は、**選択した都市の南中時刻（太陽が最も高くなる瞬間）を、常にあなたの時計の「12:00（正午）」として固定する**ことです。

その上で、あなたは「昼」の長さを自由にデザインできます。これにより、季節や場所に関わらず、あなた自身の「太陽に合わせた時間」を創り出すことができます。

### コアコンセプト：揺るぎない「正午」を基準に、一日を再設計する

-   **絶対的な基準点**: `あなたの時計の12:00` = `現実の南中時刻`
-   **カスタマイズ**: あなたが感じる「昼の長さ」を設定します。
-   **自動調整**: 「夜の長さ」は自動的に決まり、時間は太陽の動きに合わせて動的に伸縮します。

このモードを使えば、例えば冬の短い日照時間を長く活動的な昼として感じたり、夏の長い夜を休息のためのコンパクトな時間にしたりと、自分の体感時間を最適化できます。

## 💡 基本的な考え方 (The Core Idea)

このモードの鍵は、**「現実の太陽の動き」と「デザインされた時間」を、絶対的な正午(12:00)を軸にマッピングする**ことです。

1.  **現実の太陽イベント (Actual Solar Events)**
    - `SunCalc.js`ライブラリを使用し、選択された都市のその日の正確な時刻を取得します。
    - **重要な3つの現実時刻**: `日の出時刻`, `南中時刻`, `日の入り時刻`

2.  **デザインされた時間のアンカーポイント (Designed Time Anchors)**
    - あなたが`Day Hours`（昼の長さ）スライダーで「昼」を何時間と感じたいかを設定します。
    - **例**: **「デザインされた昼」を16時間**に設定したとします。
    - すると、あなたの時計のアンカーポイントは以下のように決まります。
        - **デザインされた南中**: `12:00` (常に固定)
        - **デザインされた日の出**: `12:00 - (16時間 / 2) = 04:00`
        - **デザインされた日の入り**: `12:00 + (16時間 / 2) = 20:00`
        - **デザインされた夜**: `24 - 16 = 8時間`

### 「時間の魔法」：2つの期間のマッピング

ここが最も重要なポイントです。**現実の太陽の動きの期間を、あなたがデザインした時間の期間にマッピングします。**

-   **昼のマッピング**:
    - **現実の期間**: `現実の日の出`から`現実の日の入り`まで。
    - **デザインされた期間**: `デザインされた日の出(04:00)`から`デザインされた日の入り(20:00)`まで。
    - → この間、時間は伸縮（スケーリング）します。

-   **夜のマッピング**:
    - **現実の期間**: `昨日の現実の日の入り`から`今日の現実の日の出`まで。
    - **デザインされた期間**: `昨日のデザインされた日の入り(20:00)`から`今日のデザインされた日の出(04:00)`まで。
    - → この間も、時間は昼とは異なる比率で伸縮します。

## ⚙️ 計算の仕組み (The Formula)

数式で見てみましょう。

### 1. アンカーポイントの定義
-   **現実のアンカー (Real World Anchors)**:
    -   `ts_sunrise`: 現実の日の出のタイムスタンプ
    -   `ts_solarnoon`: 現実の南中時刻のタイムスタンプ
    -   `ts_sunset`: 現実の日の入りのタイムスタンプ
-   **デザインのアンカー (Designed Anchors)** (単位: 分):
    -   `ah_noon = 12 * 60`
    -   `ah_day_duration = Day Hoursスライダーの値 * 60`
    -   `ah_sunrise = ah_noon - (ah_day_duration / 2)`
    -   `ah_sunset = ah_noon + (ah_day_duration / 2)`

### 2. 現在時刻のマッピング

現在時刻 `ts_now` がどのフェーズにあるかを判断し、線形補間を使ってマッピングします。

-   **もし `ts_now` が昼（日の出〜南中）なら**:
    \[
    \text{progress} = \frac{ts\_now - ts\_sunrise}{ts\_solarnoon - ts\_sunrise}
    \]
    \[
    \text{ah\_time} = \text{ah\_sunrise} + \text{progress} \times (\text{ah\_noon} - \text{ah\_sunrise})
    \]

-   **もし `ts_now` が昼（南中〜日の入り）なら**:
    \[
    \text{progress} = \frac{ts\_now - ts\_solarnoon}{ts\_sunset - ts\_solarnoon}
    \]
    \[
    \text{ah\_time} = \text{ah\_noon} + \text{progress} \times (\text{ah\_sunset} - \text{ah\_noon})
    \]

-   **もし `ts_now` が夜なら**:
    - 夜の期間（昨日の日の入り〜今日の日の出）で同様の計算を行います。

## 🚶‍♀️ 具体的なシナリオ (A Walkthrough)

**設定**:
- **選択した都市**: **ロンドン (London)**
- **デザインしたい昼の長さ (Day Hours)**: **15時間**

---

#### ステップ1: ロンドンの太陽情報とデザインされたアンカーを取得する

- ある日のロンドンの時刻を`SunCalc.js`で計算します。
    - **現実の日の出**: `07:30`
    - **現実の南中**: `12:00` (仮)
    - **現実の日の入り**: `16:30`
- デザインされたアンカーを計算します。
    - **デザインされた南中**: `12:00`
    - **デザインされた日の出**: `12:00 - 7.5時間 = 04:30`
    - **デザインされた日の入り**: `12:00 + 7.5時間 = 19:30`

#### ステップ2: 時間の流れを理解する

- **昼の流れ**:
    - 現実の**9時間**（`07:30` → `16:30`）が、デザインされた**15時間**（`04:30` → `19:30`）にマッピングされます。
    - したがって、昼の間、あなたの時計は現実の時間より `15 ÷ 9 ≒ 1.67倍` 速く進みます。

- **夜の流れ**:
    - 現実の**15時間**（`16:30` → 翌`07:30`）が、デザインされた**9時間**（`19:30` → 翌`04:30`）にマッピングされます。
    - したがって、夜の間、あなたの時計は現実の時間より `9 ÷ 15 = 0.6倍` 遅く進みます。

## 🎨 UI/UX Guidelines

- **都市選択 (City)**: プルダウンメニューから主要な都市を選択します。
- **情報表示 (Solar Info)**:
    - 選択した都市の「日の出」「南中」「日の入り」「昼の長さ」が、その都市のローカルタイムで自動計算・表示されます。
- **Day Hours スライダー**:
    - デザインしたい「昼」の長さを1〜23時間の間で設定します。
    - **デフォルト値**: ページ読み込み時や都市変更時、その都市の実際の「昼の長さ」がスライダーの初期値として設定されます。ユーザーはそこから微調整を始めることができます。

このモードは、天体の動きという普遍的なリズムを、あなたのライフスタイルに合わせて再解釈するための強力なツールです。

## 🎯 Success Metrics

- 位置情報の設定完了率
- 季節による使用パターンの変化
- 睡眠の質の改善（自己申告）
- 自然光利用時間の増加

## 💭 Philosophy

Solar Modeは、人類が失った「自然との時間的つながり」を回復させます。電気照明が普及する前、人々の生活は太陽とともにありました。このモードは、現代のテクノロジーを使って、その古代の知恵を再解釈します。

「時間は均一ではない」という真実を受け入れることで、私たちは季節の変化を身体で感じ、自然のリズムと調和した生活を送ることができます。夏の長い昼を有効に使い、冬の長い夜を休息と内省の時間として受け入れる—これが Solar Mode の提案する新しい時間との関係です。

## 📝 Notes

- 極地に近い地域では、白夜や極夜の処理が必要
- 都市生活者向けに「仮想太陽」モードの実装も検討
- 将来的には、月の満ち欠けも組み込んだ「Lunar-Solar Mode」への拡張も可能
- 天候データと連携し、「体感日照時間」での計算も検討

---

*Next: [Implementation Guide →](../implementation-guide.md)*