# Time Design Test Page - 仕様書と期待動作

## 📋 概要

Time Design Test Page（`/time-design-test.html`）は、Another Hour の新しい時間設計モードシステムを包括的にテストするためのページです。すべてのモードの動作確認、設定変更、リアルタイム表示を一箇所で行えます。

## 🎯 目的

1. **開発時のテスト**: 新しいモードの実装が正しく動作することを確認
2. **デバッグ**: 時間計算のロジックやエラーを視覚的に確認
3. **デモンストレーション**: 各モードの特徴を分かりやすく表示
4. **設定の実験**: 様々な設定値での動作を即座に確認

## 🏗️ ページ構成

### 1. モード選択パネル（左側）
- **表示内容**: 利用可能なすべてのモード
- **機能**: クリックでモードを切り替え
- **視覚的フィードバック**: 選択中のモードがハイライト表示

### 2. 時間表示パネル（中央上部）
- **大型デジタル時計**: 現在のAnother Hour時間
- **ラベル**: 現在の期間名（例：「Core Time」「Morning Another Hour」）
- **情報カード**: 
  - Scale Factor（時間の進む速度）
  - Real Time（実際の時刻）
  - Progress（現在の期間の進捗）
  - Current Phase（現在のフェーズ）

### 3. 設定パネル（中央下部）
- **モード別の設定UI**: 各モードに特化した入力フィールド
- **保存ボタン**: 設定を適用
- **リセットボタン**: デフォルト値に戻す
- **ステータスメッセージ**: 保存結果の表示

### 4. デバッグパネル（最下部）
- **リアルタイムログ**: システムの動作状況
- **エラー表示**: 問題が発生した場合の詳細情報
- **イベント追跡**: モード変更や設定更新の記録

## 🔧 各モードの期待動作

### Classic Mode
**設定項目**:
- Designed 24 Duration: 0〜1440分（スライダー）

**期待動作**:
1. スライダーを動かすと即座に時間の進む速度が変化
2. 23時間に設定した場合、Scale Factorは約1.04x
3. Designed 24期間中は時計が速く進む
4. Another Hour期間（最後の1時間）は通常速度

**テスト手順**:
1. Classic Modeを選択
2. Duration を1380分（23時間）に設定
3. Scale Factorが1.04xになることを確認
4. 時計の針が通常より速く動くことを確認

### Core Time Mode
**設定項目**:
- Morning AH Start: 時刻選択
- Morning AH Duration: 0〜360分
- Evening AH Duration: 0〜360分

**期待動作**:
1. 朝のAH期間は通常速度（1.0x）だが、表示はCore Timeが始まるまでのカウントダウン表示とする。（現時点でのアイデアで、変わる可能性あり）
2. Core Time期間は圧縮されて速く進む
3. 夜のAH期間は再び通常速度
4. 合計AH時間は12時間以下に制限

**テスト手順**:
1. Core Time Modeを選択
2. Morning AH: 5:00開始、2時間
3. Evening AH: 2時間
4. Core Timeが15時間（7:00-22:00）になることを確認
5. Scale Factorが1.6x（24/15）になることを確認

### Wake-Based Mode
**設定項目**:
- Today's Wake Time: 起床時刻
- Another Hour Duration 
- Default Wake Time: デフォルト起床時刻

**期待動作**:
1. 起床時刻から深夜までを1日の活動時間として扱う
2. 遅く起きるほど時間が速く進む
3. 最大2.0xまでのスケールファクター制限
4. Another Hour開始後はカウントダウン表示
5. 

**テスト手順**:
1. Wake-Based Modeを選択
2. 現在時刻より2時間前を起床時刻に設定
3. Scale Factorが1.0より大きくなることを確認
4. "Time Since Wake"が正しく表示されることを確認

### Solar Mode
**設定項目**:
- City: 場所選択（Tokyo, Kumamoto, New York, Londonなど）
- Day Hours: 昼の時間（1〜23時間）
- Sun Rise: 日の出時間
- Sun Set: 日の入り時間
- Daytime: 昼の長さ

**期待動作**:
1. 選択した都市の実際の日の出・日没時刻に基づいて計算
2. 昼と夜で異なるスケールファクター
3. Day Hoursスライダーで昼夜の時間の長さを変更可能
4. 位置情報による正確な太陽時刻
5. その日の自分の地区の日の出時間、日の入り時間、日の出から日の入りまでの時間（）が表示される。日の出から日の入り時間がDay Hours スライダーのデフォルト値に変わる（その後マニュアルで調整可能）


**テスト手順**:
1. Solar Modeを選択
2. City プルダウンから "Tokyo" を選択
3. その日のTokyoの日の出時間、日の入り時間、日の出から日の入りまでの時間が表示される。日の出から日の入り時間がDay Hours スライダーのデフォルト値に変わる（その後マニュアルで調整可能）
4. Day Hours スライダーを12に設定
5. 現在が昼か夜かで異なるScale Factorを確認
6. City プルダウンから "London" を選択
7. Scale Factorと時間表示（日の出時間、日の入り時間、日の出から日野璃々までの時間）が東京とは異なる値に変わることを確認
8. 時計が滑らかに動くことを確認

## 📊 共通のテスト項目

### 初期化テスト
1. ページロード時にエラーが出ないこと
2. TimeDesignManagerが正しく初期化されること
3. デフォルトでClassic Modeが選択されること

### モード切り替えテスト
1. 各モードをクリックして切り替えられること
2. 設定パネルが適切に更新されること
3. 時間表示が即座に反映されること
4. エラーが発生しないこと

### 設定保存テスト
1. 各設定項目を変更できること
2. 「Save Configuration」で保存されること
3. ページリロード後も設定が保持されること
4. 無効な値を入力した場合にエラーが表示されること

### パフォーマンステスト
1. 時計が滑らかに動くこと（10fps以上）
2. CPU使用率が異常に高くならないこと
3. メモリリークが発生しないこと

## 🐛 既知の問題と制限事項

1. **ブラウザ互換性**: ES6モジュールをサポートするモダンブラウザが必要
2. **タイムゾーン**: 現在はブラウザのローカルタイムゾーンを使用
3. **Solar Mode**: 簡略化された太陽計算アルゴリズム（実際の日の出・日没と数分の誤差あり）
4. **Wake-Based Mode**: 手動での起床時刻入力が必要（自動検出は未実装）

## 📝 デバッグ情報の読み方

デバッグパネルには以下の情報が表示されます：

```
[HH:MM:SS] イベント名
詳細情報（JSON形式）
```

重要なイベント：
- `Initializing Time Design Manager...` - 初期化開始
- `Mode changed event:` - モード変更
- `Configuration saved:` - 設定保存
- `Update error:` - 更新エラー

## 🎨 視覚的な確認ポイント

1. **モードカードのハイライト**: 選択中のモードが青い枠で囲まれる
2. **時間の数字**: 等幅フォントで表示され、滑らかに更新
3. **情報カード**: グリッドレイアウトで整然と配置
4. **エラー表示**: 赤い背景で目立つように表示
5. **ステータスメッセージ**: 3秒後に自動的に消える

## 🚀 将来の拡張予定

1. **グラフ表示**: 24時間の時間配分を視覚化
2. **複数モード比較**: 2つのモードを並べて表示
3. **エクスポート機能**: 設定をJSONでダウンロード
4. **共有機能**: 設定をURLで共有
5. **アニメーション**: モード切り替え時のトランジション

## 📌 重要な注意事項

- このページは開発・テスト用であり、エンドユーザー向けではありません
- すべての機能が本番環境で利用可能とは限りません
- パフォーマンスよりも機能の網羅性を優先しています
- デバッグ情報には機密情報が含まれる可能性があります

---

*最終更新: 2025年6月*